---
title: "Windows Internals"
description: "Introduction to Windows Internals."
sidebar:
  order: 3
---

import { LinkCard } from "@astrojs/starlight/components";

## Windows API

**Windows API (Application Programming Interface)**: provides a set of functions and procedures for developers to interact with the operating system, enabling applications to access system resources and services.

## User Mode and Kernel Mode

[https://learn.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode](https://learn.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode)

- **Kernel Mode:** has direct access to hardware and core system resources, responsible for managing system resources and providing services to applications.
- **User Mode:** runs applications and user processes with limited access to system resources, relying on kernel-mode components for services.

## System Architecture

the overall design and organization of Windows, including components such as:

- Process and thread management
- Memory management
- Security mechanisms
- Device driver models
- Networking and storage subsystem

## PE Format

The **Portable Executable** (**PE**) format is a [file format](https://en.wikipedia.org/wiki/File_format) for [executables](https://en.wikipedia.org/wiki/Executable), [object code](https://en.wikipedia.org/wiki/Object_file), [DLLs](https://en.wikipedia.org/wiki/Dynamic-link_library) and others used in 32-bit and 64-bit versions of [Windows](https://en.wikipedia.org/wiki/Microsoft_Windows) [operating systems](https://en.wikipedia.org/wiki/Operating_system), and in [UEFI](https://en.wikipedia.org/wiki/UEFI) environments.

These files can be identified by the [\*\*DOS MZ executable](https://en.wikipedia.org/wiki/DOS_MZ_executable)\*\* format, identified by the [ASCII](https://en.wikipedia.org/wiki/ASCII) string "MZ" ([hexadecimal](https://en.wikipedia.org/wiki/Hexadecimal): `4D 5A`) at the beginning of the file (the "[magic number](<https://en.wikipedia.org/wiki/Magic_number_(programming)>)").

![[https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg](https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg)](https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg)
Image Source: [https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg](https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg)

You can find detailed PE file format graphs here:

<LinkCard
  title="PE File Format Graphs"
  href="http://blog.dkbza.org/2012/08/pe-file-format-graphs.html"
  description="By Ero Carrera"
/>

## PE Sections

### Sections

Sections are the containers of the actual data of the executable file, they occupy the rest of the PE file after the headers, precisely after the section headers. You can learn more about the PE Sections and Headers [here](https://learn.microsoft.com/en-us/windows/win32/debug/pe-format#special-sections). Here are some of the sections of a PE file,

| Section Name    | Description                                                                                                      |
| --------------- | ---------------------------------------------------------------------------------------------------------------- |
| `.text` or CODE | Contains executable code.                                                                                        |
| `.data` or DATA | Typically Contains read/write data and global variables.                                                         |
| `.bss`          | Contains uninitialized data.                                                                                     |
| `.rdata`        | Contains read-only data. Sometimes it also contains import and export information.                               |
| `.idata`        | If present, contains the import table. If not present, then the import information is stored in .rdata section.  |
| `.edata`        | If present, contains export information. If not present, then the export information is found in .rdata section. |
| `.reloc`        | Contains image relocation information.                                                                           |
| `.rsrc`         | This section contains the resources used by the executable such as icons, dialogs, menus, strings, and so on.    |
| `.tls`          | (Thread Local Storage), provides storage for every executing thread of the program.                              |


### Fields

| Field           | Description                                                                                                                                         |
| --------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| Names           | Displays section names. In this case, the executable contains four sections (.text, .data, .rdata and .rsrc).                                       |
| Virtual-Size    | Indicates the size of the section when loaded into memory.                                                                                          |
| Virtual-Address | This is the relative virtual address (that is, offset from the base address of the executable) where the section can be found in memory.            |
| Raw-size        | Indicates the size of the section on the disk.                                                                                                      |
| Raw-data        | Indicates the offset in the file where the section can be found.                                                                                    |
| Entry-point     | This is the RVA (relative virtual address) where the code starts executing. In this case, the entry point is in the .text section, which is normal. |

## DLL

A **dynamic-link library** (**DLL**) is a [shared library](https://en.wikipedia.org/wiki/Shared_library) in the [Microsoft](https://en.wikipedia.org/wiki/Microsoft) [Windows](https://en.wikipedia.org/wiki/Microsoft_Windows) or [OS/2](https://en.wikipedia.org/wiki/OS/2) [operating system](https://en.wikipedia.org/wiki/Operating_system).

A DLL can contain [executable code](https://en.wikipedia.org/wiki/Executable_code) (functions -> Imports and Exports), [data](<https://en.wikipedia.org/wiki/Data_(computing)>), and [resources](<https://en.wikipedia.org/wiki/Resource_(Windows)>), in any combination.

You can learn more about DLLs over [here](https://learn.microsoft.com/en-us/troubleshoot/windows-client/setup-upgrade-and-drivers/dynamic-link-library).
